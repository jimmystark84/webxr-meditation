<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Infinite Crystal Float</title>
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <script>
      AFRAME.registerComponent('infinite-crystals', {
        init: function () {
          this.crystals = [];
          const count = 100;
          const colors = ['#00f2ff', '#7000ff', '#ff007b', '#00ff8c'];
          
          for (let i = 0; i < count; i++) {
            let el = document.createElement('a-entity');
            
            // Randomly choosing a more "detailed" look by nesting shapes
            el.setAttribute('geometry', {
              primitive: 'cone',
              radiusBottom: Math.random() * 0.5 + 0.1,
              height: Math.random() * 3 + 1,
              segmentsRadial: 4 // Makes it look like a shard
            });

            let color = colors[Math.floor(Math.random() * colors.length)];
            el.setAttribute('material', {
                color: color,
                emissive: color,
                emissiveIntensity: 0.5,
                transparent: true,
                opacity: 0.8,
                metalness: 1,
                roughness: 0
            });

            // Initial random spread
            this.resetCrystal(el);
            this.el.appendChild(el);
            this.crystals.push(el);
          }
        },

        resetCrystal: function(el) {
          const camPos = document.querySelector('#rig').getAttribute('position');
          // Move the crystal to a random spot far ahead of the player
          el.setAttribute('position', {
            x: camPos.x + (Math.random() - 0.5) * 100,
            y: camPos.y + (Math.random() - 0.5) * 100,
            z: camPos.z + (Math.random() - 0.5) * 100
          });
        },

        tick: function () {
          const camPos = document.querySelector('#rig').getAttribute('position');
          this.crystals.forEach(el => {
            let crystalPos = el.getAttribute('position');
            let dist = Math.sqrt(
              Math.pow(crystalPos.x - camPos.x, 2) + 
              Math.pow(crystalPos.z - camPos.z, 2)
            );
            
            // If the crystal is too far behind/away, wrap it around
            if (dist > 70) {
              this.resetCrystal(el);
            }
          });
        }
      });

      AFRAME.registerComponent('gentle-float', {
        tick: function() {
          let pos = this.el.getAttribute('position');
          let direction = new THREE.Vector3(0, 0, -1);
          this.el.object3D.getWorldDirection(direction);
          // Constant slow drift
          this.el.setAttribute('position', {
            x: pos.x + (direction.x * -0.02),
            y: pos.y + (direction.y * -0.02),
            z: pos.z + (direction.z * -0.02)
          });
        }
      });
    </script>
  </head>
  <body>
    <a-scene infinite-crystals renderer="bloom: true; antialias: false" background="color: #020205">
      
      <a-entity id="rig" gentle-float position="0 0 0">
        <a-camera look-controls></a-camera>
        <a-entity oculus-touch-controls="hand: left"></a-entity>
        <a-entity oculus-touch-controls="hand: right"></a-entity>
      </a-entity>

      <a-starsystem count="1000" radius="200" depth="100"></a-starsystem>

      <a-light type="ambient" intensity="0.2"></a-light>
      <a-light type="point" intensity="2" position="0 5 0" distance="50"></a-light>

    </a-scene>
  </body>
</html>
