<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Infinite Crystal Clusters</title>
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <script>
      // COMPONENT: Creates the detailed crystal clusters you saw in the image
      AFRAME.registerComponent('crystal-clusters', {
        init: function () {
          const sceneEl = this.el;
          const clusterCount = 35; 
          const colors = ['#00f2ff', '#7000ff', '#ff007b', '#b0fbff'];

          for (let i = 0; i < clusterCount; i++) {
            let clusterWrap = document.createElement('a-entity');
            
            // Build the "Detailed" look by grouping 6 shards together
            for (let j = 0; j < 6; j++) {
              let shard = document.createElement('a-cone');
              shard.setAttribute('radius-bottom', Math.random() * 0.4 + 0.1);
              shard.setAttribute('height', Math.random() * 2 + 1);
              shard.setAttribute('segments-radial', 4);
              shard.setAttribute('rotation', {
                x: Math.random() * 360, y: Math.random() * 360, z: Math.random() * 360
              });

              let col = colors[Math.floor(Math.random() * colors.length)];
              shard.setAttribute('material', {
                color: col,
                emissive: col,
                emissiveIntensity: 0.8,
                opacity: 0.7,
                transparent: true,
                metalness: 1
              });
              
              // Add a "Breathing" pulse effect to each shard
              shard.setAttribute('animation__pulse', {
                property: 'material.emissiveIntensity',
                from: 0.4,
                to: 1.5,
                dur: 2000 + Math.random() * 3000,
                dir: 'alternate',
                loop: true
              });

              clusterWrap.appendChild(shard);
            }

            clusterWrap.setAttribute('position', {
              x: (Math.random() - 0.5) * 60,
              y: (Math.random() - 0.5) * 60,
              z: (Math.random() - 0.5) * 60
            });

            // Spin the whole cluster like a kaleidoscope
            clusterWrap.setAttribute('animation__rotate', {
              property: 'rotation',
              to: '360 360 360',
              loop: true,
              dur: 30000 + Math.random() * 20000,
              easing: 'linear'
            });

            sceneEl.appendChild(clusterWrap);
          }
        }
      });

      // COMPONENT: Keeps the world infinite by wrapping objects
      AFRAME.registerComponent('infinite-loop', {
        tick: function () {
          const camPos = document.querySelector('#rig').object3D.position;
          this.el.childNodes.forEach(child => {
            if (child.object3D) {
                let dist = child.object3D.position.distanceTo(camPos);
                if (dist > 50) {
                    // Reposition far ahead of the player
                    child.setAttribute('position', {
                        x: camPos.x + (Math.random() - 0.5) * 80,
                        y: camPos.y + (Math.random() - 0.5) * 80,
                        z: camPos.z + (Math.random() - 0.5) * 80
                    });
                }
            }
          });
        }
      });

      // COMPONENT: The gentle forward drift
      AFRAME.registerComponent('drift', {
        tick: function() {
          let pos = this.el.getAttribute('position');
          let direction = new THREE.Vector3(0, 0, -1);
          this.el.object3D.getWorldDirection(direction);
          this.el.setAttribute('position', {
            x: pos.x + (direction.x * -0.015),
            y: pos.y + (direction.y * -0.015),
            z: pos.z + (direction.z * -0.015)
          });
        }
      });
    </script>
  </head>
  <body>
    <a-scene crystal-clusters infinite-loop renderer="antialias: false" background="color: #020205">
      
      <a-entity id="rig" drift position="0 0 0">
        <a-camera look-controls></a-camera>
        <a-entity oculus-touch-controls="hand: left"></a-entity>
        <a-entity oculus-touch-controls="hand: right"></a-entity>
      </a-entity>

      <a-entity animation="property: rotation; to: 0 360 360; loop: true; dur: 200000; easing: linear">
        <a-sky color="#050510" radius="100"></a-sky>
        <a-stars count="5000" radius="95" color="#FFF"></a-stars>
      </a-entity>

      <a-light type="ambient" intensity="0.3"></a-light>
    </a-scene>
  </body>
</html>
