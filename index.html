<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Milky Way Crystal Voyage</title>
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <script>
      // Detailed Cluster Logic
      AFRAME.registerComponent('milky-way-clusters', {
        init: function () {
          const sceneEl = this.el;
          const clusterCount = 180; // Ultra high density
          const colors = ['#00f2ff', '#7000ff', '#ff007b', '#ffffff', '#ff9d00'];

          for (let i = 0; i < clusterCount; i++) {
            let clusterWrap = document.createElement('a-entity');
            
            for (let j = 0; j < 8; j++) {
              let shard = document.createElement('a-cone');
              shard.setAttribute('radius-bottom', Math.random() * 0.5 + 0.2);
              shard.setAttribute('height', Math.random() * 5 + 1);
              shard.setAttribute('segments-radial', 6);
              shard.setAttribute('rotation', {
                x: Math.random() * 360, y: Math.random() * 360, z: Math.random() * 360
              });

              let col = colors[Math.floor(Math.random() * colors.length)];
              shard.setAttribute('material', {
                color: col,
                emissive: col,
                emissiveIntensity: 1.5,
                metalness: 1,
                roughness: 0.1,
                transparent: true,
                opacity: 0.7
              });
              clusterWrap.appendChild(shard);
            }

            // Scatter clusters along a deep Z-axis
            clusterWrap.setAttribute('position', {
              x: (Math.random() - 0.5) * 150,
              y: (Math.random() - 0.5) * 150,
              z: (Math.random() * -300) + 50
            });

            clusterWrap.setAttribute('animation', {
              property: 'rotation',
              to: '360 360 360',
              loop: true,
              dur: 15000 + Math.random() * 20000,
              easing: 'linear'
            });

            sceneEl.appendChild(clusterWrap);
          }
        }
      });

      // Infinite Space Loop
      AFRAME.registerComponent('space-loop', {
        tick: function () {
          const camPos = document.querySelector('#rig').object3D.position;
          this.el.childNodes.forEach(child => {
            if (child.object3D && child.object3D.position.z > camPos.z + 30) {
                child.object3D.position.z = camPos.z - 250;
                child.object3D.position.x = (Math.random() - 0.5) * 150;
                child.object3D.position.y = (Math.random() - 0.5) * 150;
            }
          });
        }
      });
    </script>
  </head>
  <body>
    <a-scene milky-way-clusters space-loop renderer="colorManagement: true; exposure: 1.2;">
      
      <a-assets>
        <img id="milkyway" src="https://cdn.glitch.global/605e2a51-d45f-4d87-a285-9410ad350515/milkyway.jpg?v=1642610115682">
      </a-assets>

      <a-sky src="#milkyway" rotation="0 -90 0" animation="property: rotation; to: 0 270 0; dur: 500000; loop: true; easing: linear"></a-sky>

      <a-entity starsystem="count: 10000; radius: 250; color: #FFF; depth: 300"></a-entity>

      <a-entity id="rig" position="0 0 0" animation="property: position; to: 0 0 -10000; dur: 1000000; easing: linear">
        <a-camera look-controls></a-camera>
        <a-entity oculus-touch-controls="hand: left"></a-entity>
        <a-entity oculus-touch-controls="hand: right"></a-entity>
      </a-entity>

      <a-light type="ambient" intensity="0.4" color="#4c566a"></a-light>
      <a-light type="point" intensity="2" position="0 0 -5" distance="50" color="#fff"></a-light>

    </a-scene>
  </body>
</html>
